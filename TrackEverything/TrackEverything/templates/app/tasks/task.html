{% import "bootstrap/wtf.html" as wtf %}
{% import "bootstrap/utils.html" as utils %}
{% extends "base.html" %}
{% block title %}
    {% if add_task %}
        Add Task
    {% else %}
        Edit Task
    {% endif %}
{% endblock %}
{% block body %}
<div class="content-section">
 <div class="outer">
    <div class="middle">
      <div class="inner">
      <br/>
        {{ utils.flashed_messages() }}
        <br/>
        <div class="center">
            {% if add_task %}
                <h1>Add Task</h1>
            {% else %}
                <h1>Edit Task</h1>
            {% endif %}
            <br/>
           <form method="POST" role="form" class="form form-horizontal">
           {{ form.csrf_token }}
           {{ wtf.form_field(form.name) }}
           {{ wtf.form_field(form.description) }}
           {{ wtf.form_field(form.status) }}
           {{ wtf.form_field(form.start_date) }}
           {{ wtf.form_field(form.end_date) }}
           {% if add_task %}
              {{ wtf.form_field(form.project) }}
           {% endif %}
           {{ wtf.form_field(form.performers) }}
           <input type="submit">
           </form>
           <script>
              var project_select = document.getElementById("project")
              var performers_select = document.getElementById("performers")

              project_select.onchange = function() {
                project_id = project_select.value;

                fetch('/projects/' + project_id + '/users').then(function(response) {
                  response.json().then(function(data) {
                    var optionHTML = '';

                    for (var user of data.users) {
                      optionHTML += '<option value="' + user.pk +'">' + user.username + '</option>';
                    }

                    performers_select.innerHTML = optionHTML;
                  })
                });
              }
           </script>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}